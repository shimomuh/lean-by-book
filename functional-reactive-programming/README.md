# 関数型リアクティブプログラミング

Stephen Blackheath 著

Anthony Jones 著

## 2.4 参照透過的でなければならない

> FRPを正しく機能させるには、mapに関数として渡されるコードが参照透過的（referentiallytransparent）でなければならない。参照透過的であることを純粋（pure）であるとも言う。純粋であるためには、次の要件が満たされていなければならない。
> 
> * I/Oをいっさい実行してはならない。
> * 関数内でキャッチして処理する場合を除いて、例外をスローしてはならない。
> * 外部変数の値が変化する可能性がある場合、その値を読み取ってはならない。これに対し、定数の読み取りは可能であり、推奨される。
> * 外部から参照可能な状態を変更してはならない。
> * 関数の呼び出しにまたがって状態を維持してはならない。
> * 要するに、関数は値を返す以外の方法で外部に「影響」を与えてはならず、外部の状態による影響を受けてはならない。


## 2.9.2 明示的なトランザクションで FRP を構築する

Sodium という関数型リアクティブプログラミングの例題に使われている Rx ライブラリの一つの原則には、

> プログラムの FRP ロジックを 1 つの大きな、明示的なトランザクションの中で作成することである。

## 8.3 トランザクション

> Sodiumではそもそも、トランザクションを作成しない場合は、自動的に作成される。たとえば次のコードでは、sendはそれぞれ新しいトランザクションで実行される。

```java
sSnk.send(5); //トランザクション1で実行
eSnk.send(6); //トランザクション2で実行
eSnk.send(7); //トランザクション3で実行
```

> Sodiumでは、トランザクションを明示的に作成することもできる。

```java
Transaction.runVoid(() -> {
  ...トランザクションの中で実行するコード
}
```

> このコードは **Loan パターン** を使用している

> Loanパターンは、何らかのリソースを管理する関数にラムダ形式のコードを与え、その関数に渡されたコードにリソースを「貸し付ける」というソフトウェアデザインパターンである。要するに、呼び出し元によるリソースの閉じ忘れをなくすことで、リソースがリークする可能性を低下させるのである。

> Loanパターンのユースケースとして最もよく知られているのは、ファイルの開閉である。
